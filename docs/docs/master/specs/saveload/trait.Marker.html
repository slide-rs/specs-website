<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `Marker` trait in crate `specs`.">
    <meta name="keywords" content="rust, rustlang, rust-lang, Marker">

    <title>specs::saveload::Marker - Rust</title>

    <link rel="stylesheet" type="text/css" href="../../normalize.css">
    <link rel="stylesheet" type="text/css" href="../../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../../main.css">
    

    
    
</head>
<body class="rustdoc trait">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'>Trait Marker</p><div class="block items"><ul><li><a href="#associated-types">Associated Types</a></li><li><a href="#required-methods">Required Methods</a></li><li><a href="#provided-methods">Provided Methods</a></li><li><a href="#implementors">Implementors</a></li></ul></div><p class='location'><a href='../index.html'>specs</a>::<wbr><a href='index.html'>saveload</a></p><script>window.sidebarCurrent = {name: 'Marker', ty: 'trait', relpath: ''};</script><script defer src="sidebar-items.js"></script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content">
<h1 class='fqn'><span class='in-band'>Trait <a href='../index.html'>specs</a>::<wbr><a href='index.html'>saveload</a>::<wbr><a class="trait" href=''>Marker</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a class='srclink' href='../../src/specs/saveload/marker.rs.html#134-155' title='goto source code'>[src]</a></span></h1>
<pre class='rust trait'>pub trait Marker: <a class="trait" href="../../specs/trait.Component.html" title="trait specs::Component">Component</a> + <a class="trait" href="../../serde/de/trait.DeserializeOwned.html" title="trait serde::de::DeserializeOwned">DeserializeOwned</a> + <a class="trait" href="../../serde/ser/trait.Serialize.html" title="trait serde::ser::Serialize">Serialize</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Copy.html" title="trait core::marker::Copy">Copy</a> {
    type <a href='#associatedtype.Identifier' class="type">Identifier</a>: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Copy.html" title="trait core::marker::Copy">Copy</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html" title="trait core::fmt::Debug">Debug</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/cmp/trait.Eq.html" title="trait core::cmp::Eq">Eq</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/hash/trait.Hash.html" title="trait core::hash::Hash">Hash</a>;
    type <a href='#associatedtype.Allocator' class="type">Allocator</a>: <a class="trait" href="../../specs/saveload/trait.MarkerAllocator.html" title="trait specs::saveload::MarkerAllocator">MarkerAllocator</a>&lt;Self&gt;;
    fn <a href='#tymethod.id' class='fnname'>id</a>(&amp;self) -&gt; Self::<a class="type" href="../../specs/saveload/trait.Marker.html#associatedtype.Identifier" title="type specs::saveload::Marker::Identifier">Identifier</a>;

    fn <a href='#method.update' class='fnname'>update</a>(&amp;mut self, update: Self) { ... }
}</pre><div class='docblock'><p>This trait should be implemented by a component which is going to be used as marker.
This marker should be set to entity that should be serialized.
If serialization strategy needs to set marker to some entity
then it should use newly allocated marker from <code>Marker::Allocator</code>.</p>

<h2 id='example' class='section-header'><a href='#example'>Example</a></h2>
<pre class="rust rust-example-rendered">
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">specs</span>;
<span class="attribute">#[<span class="ident">macro_use</span>]</span> <span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">serde</span>;
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">collections</span>::<span class="ident">HashMap</span>;
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">ops</span>::<span class="ident">Range</span>;
<span class="kw">use</span> <span class="ident">specs</span>::{<span class="ident">Component</span>, <span class="ident">Entity</span>, <span class="ident">DenseVecStorage</span>};
<span class="kw">use</span> <span class="ident">specs</span>::<span class="ident">saveload</span>::{<span class="ident">Marker</span>, <span class="ident">MarkerAllocator</span>};

<span class="comment">// Marker for entities that should be synced over network</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Copy</span>, <span class="ident">Serialize</span>, <span class="ident">Deserialize</span>)]</span>
<span class="kw">struct</span> <span class="ident">NetMarker</span> {
    <span class="ident">id</span>: <span class="ident">u64</span>,
    <span class="ident">seq</span>: <span class="ident">u64</span>,
}

<span class="kw">impl</span> <span class="ident">Component</span> <span class="kw">for</span> <span class="ident">NetMarker</span> {
    <span class="kw">type</span> <span class="ident">Storage</span> <span class="op">=</span> <span class="ident">DenseVecStorage</span><span class="op">&lt;</span><span class="self">Self</span><span class="op">&gt;</span>;
}

<span class="kw">impl</span> <span class="ident">Marker</span> <span class="kw">for</span> <span class="ident">NetMarker</span> {
    <span class="kw">type</span> <span class="ident">Identifier</span> <span class="op">=</span> <span class="ident">u64</span>;
    <span class="kw">type</span> <span class="ident">Allocator</span> <span class="op">=</span> <span class="ident">NetNode</span>;

    <span class="kw">fn</span> <span class="ident">id</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-&gt;</span> <span class="ident">u64</span> {
        <span class="self">self</span>.<span class="ident">id</span>
    }

    <span class="comment">// Updates sequence id.</span>
    <span class="comment">// Entities with too old sequence id get deleted.</span>
    <span class="kw">fn</span> <span class="ident">update</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">update</span>: <span class="self">Self</span>) {
        <span class="macro">assert_eq</span><span class="macro">!</span>(<span class="self">self</span>.<span class="ident">id</span>, <span class="ident">update</span>.<span class="ident">id</span>);
        <span class="self">self</span>.<span class="ident">seq</span> <span class="op">=</span> <span class="ident">update</span>.<span class="ident">seq</span>;
    }
}

<span class="comment">// Each client and server has one</span>
<span class="comment">// Contains id range and `NetMarker -&gt; Entity` mapping</span>
<span class="kw">struct</span> <span class="ident">NetNode</span> {
    <span class="ident">range</span>: <span class="ident">Range</span><span class="op">&lt;</span><span class="ident">u64</span><span class="op">&gt;</span>,
    <span class="ident">mapping</span>: <span class="ident">HashMap</span><span class="op">&lt;</span><span class="ident">u64</span>, <span class="ident">Entity</span><span class="op">&gt;</span>,
}

<span class="kw">impl</span> <span class="ident">MarkerAllocator</span><span class="op">&lt;</span><span class="ident">NetMarker</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">NetNode</span> {
    <span class="kw">fn</span> <span class="ident">allocate</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">entity</span>: <span class="ident">Entity</span>, <span class="ident">id</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">u64</span><span class="op">&gt;</span>) <span class="op">-&gt;</span> <span class="ident">NetMarker</span> {
        <span class="kw">let</span> <span class="ident">id</span> <span class="op">=</span> <span class="ident">id</span>.<span class="ident">unwrap_or_else</span>(<span class="op">||</span> {
            <span class="self">self</span>.<span class="ident">range</span>.<span class="ident">next</span>().<span class="ident">expect</span>(<span class="string">&quot;Id range must be virtually endless&quot;</span>)
        });
        <span class="kw">let</span> <span class="ident">marker</span> <span class="op">=</span> <span class="ident">NetMarker</span> {
            <span class="ident">id</span>: <span class="ident">id</span>,
            <span class="ident">seq</span>: <span class="number">0</span>,
        };
        <span class="self">self</span>.<span class="ident">mapping</span>.<span class="ident">insert</span>(<span class="ident">id</span>, <span class="ident">entity</span>);
        <span class="ident">marker</span>
    }

    <span class="kw">fn</span> <span class="ident">get</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">id</span>: <span class="ident">u64</span>) <span class="op">-&gt;</span> <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">Entity</span><span class="op">&gt;</span> {
        <span class="self">self</span>.<span class="ident">mapping</span>.<span class="ident">get</span>(<span class="kw-2">&amp;</span><span class="ident">id</span>).<span class="ident">cloned</span>()
    }
}

<span class="kw">fn</span> <span class="ident">main</span>() {
    <span class="kw">use</span> <span class="ident">specs</span>::<span class="ident">World</span>;

    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">world</span> <span class="op">=</span> <span class="ident">World</span>::<span class="ident">new</span>();
    <span class="ident">world</span>.<span class="ident">register</span>::<span class="op">&lt;</span><span class="ident">NetMarker</span><span class="op">&gt;</span>();

    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">node</span> <span class="op">=</span> <span class="ident">NetNode</span> {
        <span class="ident">range</span>: <span class="number">0</span>..<span class="number">100</span>,
        <span class="ident">mapping</span>: <span class="ident">HashMap</span>::<span class="ident">new</span>(),
    };

    <span class="kw">let</span> <span class="ident">entity</span> <span class="op">=</span> <span class="ident">world</span>.<span class="ident">create_entity</span>().<span class="ident">build</span>();
    <span class="kw">let</span> (<span class="ident">marker</span>, <span class="ident">added</span>) <span class="op">=</span> <span class="ident">node</span>.<span class="ident">mark</span>(<span class="ident">entity</span>, <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">world</span>.<span class="ident">write</span>::<span class="op">&lt;</span><span class="ident">NetMarker</span><span class="op">&gt;</span>());
    <span class="macro">assert</span><span class="macro">!</span>(<span class="ident">added</span>);
    <span class="macro">assert_eq</span><span class="macro">!</span>(
        <span class="ident">node</span>.<span class="ident">get_marked</span>(<span class="ident">marker</span>.<span class="ident">id</span>(), <span class="kw-2">&amp;</span><span class="ident">world</span>.<span class="ident">entities</span>(), <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">world</span>.<span class="ident">write</span>::<span class="op">&lt;</span><span class="ident">NetMarker</span><span class="op">&gt;</span>()),
        <span class="ident">entity</span>
    );
}</pre>
</div>
            <h2 id='associated-types' class='small-section-header'>
              Associated Types<a href='#associated-types' class='anchor'></a>
            </h2>
            <div class='methods'>
        <h3 id='associatedtype.Identifier' class='method'><span id='Identifier.t' class='invisible'><code>type <a href='#associatedtype.Identifier' class="type">Identifier</a>: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Copy.html" title="trait core::marker::Copy">Copy</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html" title="trait core::fmt::Debug">Debug</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/cmp/trait.Eq.html" title="trait core::cmp::Eq">Eq</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/hash/trait.Hash.html" title="trait core::hash::Hash">Hash</a></code></span></h3><div class='docblock'><p>Id of the marker</p>
</div><h3 id='associatedtype.Allocator' class='method'><span id='Allocator.t' class='invisible'><code>type <a href='#associatedtype.Allocator' class="type">Allocator</a>: <a class="trait" href="../../specs/saveload/trait.MarkerAllocator.html" title="trait specs::saveload::MarkerAllocator">MarkerAllocator</a>&lt;Self&gt;</code></span></h3><div class='docblock'><p>Allocator for this <code>Marker</code></p>
</div></div>
            <h2 id='required-methods' class='small-section-header'>
              Required Methods<a href='#required-methods' class='anchor'></a>
            </h2>
            <div class='methods'>
        <h3 id='tymethod.id' class='method'><span id='id.v' class='invisible'><code>fn <a href='#tymethod.id' class='fnname'>id</a>(&amp;self) -&gt; Self::<a class="type" href="../../specs/saveload/trait.Marker.html#associatedtype.Identifier" title="type specs::saveload::Marker::Identifier">Identifier</a></code></span></h3><div class='docblock'><p>Get this marker internal id</p>
</div></div>
            <h2 id='provided-methods' class='small-section-header'>
              Provided Methods<a href='#provided-methods' class='anchor'></a>
            </h2>
            <div class='methods'>
        <h3 id='method.update' class='method'><span id='update.v' class='invisible'><code>fn <a href='#method.update' class='fnname'>update</a>(&amp;mut self, update: Self)</code></span></h3><div class='docblock'><p>Update marker with new value.
It must preserve the internal <code>Identifier</code>.</p>

<h2 id='panics' class='section-header'><a href='#panics'>Panics</a></h2>
<p>Allowed to panic if <code>self.id() != update.id()</code>.
But usually implementer may ignore the value of the <code>update.id()</code>
as deserialization algorithm ensures <code>id()</code>s match.</p>
</div></div>
        <h2 id='implementors' class='small-section-header'>
          Implementors<a href='#implementors' class='anchor'></a>
        </h2>
        <ul class='item-list' id='implementors-list'>
    <li><div class='out-of-band'><a class='srclink' href='../../src/specs/saveload/marker.rs.html#217-223' title='goto source code'>[src]</a></div><code>impl Marker for <a class="struct" href="../../specs/saveload/struct.U64Marker.html" title="struct specs::saveload::U64Marker">U64Marker</a><span class="where fmt-newline">  type <a href='#associatedtype.Identifier' class="type">Identifier</a> = <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>;</span><span class="where fmt-newline">  type <a href='#associatedtype.Allocator' class="type">Allocator</a> = <a class="struct" href="../../specs/saveload/struct.U64MarkerAllocator.html" title="struct specs::saveload::U64MarkerAllocator">U64MarkerAllocator</a>;</span></code></li>
</ul><script type="text/javascript" async
                         src="../../implementors/specs/saveload/trait.Marker.js">
                 </script></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../../";
        window.currentCrate = "specs";
    </script>
    <script src="../../main.js"></script>
    <script defer src="../../search-index.js"></script>
</body>
</html>